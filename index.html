<!DOCTYPE html>
<html lang="de" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè†</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #f9fafb;
            --text-color-light: #6b7280;
            --header-text-color: #111827;
            --sidebar-bg: #f3f4f6cc;
            --sidebar-border: #e5e7eb;
            --modal-bg: #ffffff;
            --accent-color: #7c3aed;
            --accent-color-hover: #8b5cf6;
            --sidebar-link-active-bg: #7c3aed;
        }

        html[data-theme='dark'] {
            --bg-color: #171717;
            --text-color-light: #a3a3a3;
            --header-text-color: #fafafa;
            --sidebar-bg: #262626cc;
            --sidebar-border: #404040;
            --modal-bg: #262626;
            --accent-color: #7c3aed;
            --accent-color-hover: #8b5cf6;
            --sidebar-link-active-bg: #7c3aed;
        }

        html,
        body {
            height: 100%;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color-light);
            overflow: hidden;
        }

        /* Haupt-Inhaltsbereich relativ positioniert f√ºr den Loader */
        #main-content {
            position: relative;
        }

        /* Lade-Abdeckung f√ºr den Iframe-Wechsel */
        #content-loader {
            position: absolute;
            inset: 0;
            background-color: var(--bg-color);
            z-index: 10;
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
            /* Klicks durchlassen, wenn unsichtbar */
        }
        #content-loader.hidden {
            opacity: 0;
        }

        .content-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
            opacity: 0;
            transition: opacity 200ms ease-in-out;
            pointer-events: none;
        }

        .content-iframe.active {
            opacity: 1;
            pointer-events: auto;
        }
        /* Desktop Sidebar: Bleibt fixiert, Hover-Effekt wie bisher */
        #sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 50;
            width: 4.5rem;
            transition: width 0.3s;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--sidebar-border);
            backdrop-filter: blur(8px);
            display: none; /* Standardm√§√üig auf mobilen Ger√§ten ausblenden */
            flex-direction: column;
            /* Anordnung in Spalte */
            justify-content: space-between;
            /* Elemente oben und unten ausrichten */
        }

        @media (min-width: 768px) { /* Tailwind's 'md' breakpoint */
            #sidebar {
                display: flex;
            }
        }

        #sidebar:hover {
            width: 16rem;
        }

        .sidebar-text {
            opacity: 0;
            max-width: 0;
            transition: opacity 0.2s ease, max-width 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            margin-left: 0.75rem;
        }

        #sidebar:hover .sidebar-text {
            opacity: 1;
            max-width: 150px;
        }

        .sidebar-link {
            color: var(--text-color-light);
        }

        .sidebar-link:hover {
            background-color: var(--accent-color-hover);
            color: #ffffff;
        }

        .sidebar-link.active {
            background-color: var(--sidebar-link-active-bg);
            color: #ffffff;
        }

        /* Styling for the new SVG icon */
        .sidebar-link svg .st0 {
            /* We set fill to currentColor, but the path also uses a stroke for the outlines */
            fill: none;
            /* Make sure the path is not filled if we want only a stroke */
            stroke: currentColor;
            /* Inherit color from parent for the SVG stroke */
            stroke-width: 0.5;
            /* Adjust this value to make the stroke thicker or thinner */
        }

        /* Copyright Text */
        .copyright-text {
            opacity: 0;
            max-width: 0;
            transition: opacity 0.2s ease, max-width 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            margin-left: 0.75rem;
            color: var(--text-color-light);
            text-align: center;
            padding-bottom: 1rem;
            /* Abstand vom unteren Rand */
        }

        #sidebar:hover .copyright-text {
            opacity: 1;
            max-width: 150px;
        }

        /* Mobile Header */
        #mobile-header {
            background-color: var(--sidebar-bg);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--sidebar-border);
        }

        /* Mobile Menu Panel */
        #mobile-menu {
            background-color: var(--bg-color);
            border-right: 1px solid var(--sidebar-border);
        }

        #mobile-menu.open {
            transform: translateX(0);
        }

        #settings-modal {
            background-color: var(--modal-bg);
            z-index: 100;
        }

        .theme-radio-label {
            border: 2px solid var(--sidebar-border);
            color: var(--text-color-light);
            transition: background-color 0.2s, color 0.2s;
        }

        .theme-radio-label:hover {
            background-color: var(--sidebar-border);
            color: var(--header-text-color);
        }

        .theme-radio-peer:checked~.theme-radio-label {
            border-color: var(--accent-color);
            color: var(--header-text-color);
            background-color: transparent;
        }

        .theme-radio-peer:checked~.theme-radio-label:hover {
            background-color: var(--sidebar-border);
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body data-theme="system">

    <!-- Mobile Header (wird auf md und gr√∂sser versteckt) -->
    <header id="mobile-header" class="md:hidden fixed top-0 left-0 right-0 z-40 flex items-center justify-between p-4">
        <span id="mobile-header-title" class="font-bold text-lg"
            style="color: var(--header-text-color);">Appdrawer</span>
        <button id="hamburger-btn" class="p-1">
            <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
        </button>
    </header>

    <!-- Sidebar Navigation (wird auf kleinen Bildschirmen versteckt) -->
    <nav id="sidebar" class="p-2">
        <ul id="nav-links" class="space-y-2 mt-2 flex-grow">
            <li><a href="appdrawer.html" data-target="frame-appdrawer"
                    class="sidebar-link flex items-center p-3 rounded-lg active"><svg
                        class="w-8 h-8 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 8.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25v2.25A2.25 2.25 0 0 1 8.25 21H6a2.25 2.25 0 0 1-2.25-2.25v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25h2.25A2.25 2.25 0 0 1 20.25 6v2.25a2.25 2.25 0 0 1-2.25 2.25h-2.25A2.25 2.25 0 0 1 13.5 8.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25h2.25a2.25 2.25 0 0 1 2.25 2.25v2.25a2.25 2.25 0 0 1-2.25 2.25h-2.25a2.25 2.25 0 0 1-2.25-2.25v-2.25Z" />
                    </svg><span class="sidebar-text font-medium">Appdrawer</span></a></li>
            <li><a href="unicorn/work-tools.html" target="_blank" rel="noopener noreferrer" class="sidebar-link flex items-center p-3 rounded-lg">
                    <svg class="w-8 h-8 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                        stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path
                            d="M16.414 16.414a2 2 0 0 1 -2.828 0l-2.828 -2.828a2 2 0 0 1 0 -2.828l2.828 -2.828a2 2 0 0 1 2.828 0l2.828 2.828a2 2 0 0 1 0 2.828l-2.828 2.828z" />
                        <path d="M15 11l-2 -2" />
                        <path d="M18 14l-2 -2" />
                        <path d="M12 3l2 3l2 -3" />
                        <path d="M3 15l1 1" />
                        <path d="M19 15l1 1" />
                        <path d="M12 21l-1 -1" />
                        <path d="M7 12a5 5 0 0 1 5 -5h2a3 3 0 0 1 3 3v2a5 5 0 0 1 -5 5h-2a3 3 0 0 1 -3 -3z" />
                        <path d="M10 14l-1 -1" />
                    </svg>
                    <span class="sidebar-text font-medium">Unicorn</span>
                </a></li>
            <li><a href="widgets/widgets-iframe.html" data-target="frame-widgets"
                    class="sidebar-link flex items-center p-3 rounded-lg"><svg
                        class="w-8 h-8 flex-shrink-0" viewBox="0 0 24 24" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M2 12C2 10.1308 2 9.19615 2.40192 8.5C2.66523 8.04394 3.04394 7.66523 3.5 7.40192C4.19615 7 5.13077 7 7 7H17C18.8692 7 19.8038 7 20.5 7.40192C20.9561 7.66523 21.3348 8.04394 21.5981 8.5C22 9.19615 22 10.1308 22 12C22 13.8692 22 14.8038 21.5981 15.5C21.3348 15.9561 20.9561 16.3348 20.5 16.5981C19.8038 17 18.8692 17 17 17H7C5.13077 17 4.19615 17 3.5 16.5981C3.04394 16.3348 2.66523 15.9561 2.40192 15.5C2 14.8038 2 13.8692 2 12Z"
                            stroke="currentColor" stroke-width="1.5" />
                        <path d="M19 4C19 2.89543 18.1046 2 17 2H7C5.89543 2 5 2.89543 5 4" stroke="currentColor"
                            stroke-width="1.5" />
                        <path d="M19 20C19 21.1046 18.1046 22 17 22H7C5.89543 22 5 21.1046 5 20" stroke="currentColor"
                            stroke-width="1.5" />
                        <rect x="5.5" y="10.5" width="5" height="1" rx="0.5" stroke="currentColor" />
                    </svg><span class="sidebar-text font-medium">Widgets</span></a></li>
            <li><button id="settings-btn" class="sidebar-link w-full flex items-center p-3 rounded-lg"><svg
                        class="w-8 h-8 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
                    </svg><span class="sidebar-text font-medium">Einstellungen</span></button></li>
        </ul>
        <!-- Copyright Text -->
        <div class="copyright-text">
            <span>&copy; dev0gig</span>
        </div>
    </nav>

    <!-- Mobile Menu Panel -->
    <div id="mobile-menu-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>
    <nav id="mobile-menu"
        class="fixed top-0 left-0 h-full w-72 z-50 transform -translate-x-full transition-transform duration-300 ease-in-out p-4">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold" style="color: var(--header-text-color);">Men√º</h2>
            <button id="close-mobile-menu-btn" class="p-1">
                <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <ul id="mobile-nav-links" class="space-y-2">
            <!-- Mobile links werden hier via JS eingef√ºgt -->
        </ul>
        <!-- Copyright Text f√ºr Mobile (optional, je nach Designwunsch) -->
        <div class="absolute bottom-4 left-0 w-full text-center text-sm" style="color: var(--text-color-light);">
            <span>&copy; Copyright dev0gig</span>
        </div>
    </nav>

    <!-- Iframe Content Area -->
    <main id="main-content" class="h-full pt-20 md:pt-0 md:ml-20">
        <div class="relative w-full h-full">
            <div id="content-loader"></div>
            <iframe id="frame-appdrawer" src="appdrawer.html" class="content-iframe active"></iframe>
            <iframe id="frame-widgets" src="widgets/widgets-iframe.html" class="content-iframe"></iframe>
        </div>
    </main>

    <!-- Settings Modal -->
    <div id="modal-overlay" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50"></div>
    <div id="settings-modal"
        class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md rounded-lg shadow-2xl p-6 z-[60]">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold" style="color: var(--header-text-color);">Einstellungen</h2>
            <button id="close-modal-btn" class="hover:text-white text-2xl"
                style="color: var(--text-color-light);">&times;</button>
        </div>
        <div>
            <h3 class="text-lg font-semibold mb-3" style="color: var(--header-text-color);">Erscheinungsbild</h3>
            <fieldset class="space-y-3">
                <legend class="sr-only">Theme selection</legend>
                <div><input type="radio" name="theme" id="theme-light" value="light"
                        class="theme-radio-peer hidden"><label for="theme-light"
                        class="theme-radio-label block w-full p-3 text-center rounded-lg cursor-pointer">Light</label>
                </div>
                <div><input type="radio" name="theme" id="theme-dark" value="dark"
                        class="theme-radio-peer hidden"><label for="theme-dark"
                        class="theme-radio-label block w-full p-3 text-center rounded-lg cursor-pointer">Dark</label>
                </div>
                <div><input type="radio" name="theme" id="theme-system" value="system"
                        class="theme-radio-peer hidden"><label for="theme-system"
                        class="theme-radio-label block w-full p-3 text-center rounded-lg cursor-pointer">System</label>
                </div>
            </fieldset>
        </div>
    </div>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            const contentLoader = document.getElementById('content-loader');
            const contentFrames = document.querySelectorAll('.content-iframe');

            // --- Desktop Sidebar ---
            const desktopNavLinks = document.querySelectorAll('#nav-links > li > a, #nav-links > li > button');

            // --- Mobile Menu ---
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            const closeMobileMenuBtn = document.getElementById('close-mobile-menu-btn');
            const mobileNavLinksContainer = document.getElementById('mobile-nav-links');
            const mobileHeaderTitle = document.getElementById('mobile-header-title');

            // --- Settings Modal ---
            const settingsModal = document.getElementById('settings-modal');
            const modalOverlay = document.getElementById('modal-overlay');
            const closeModalBtn = document.getElementById('close-modal-btn');

            const openMobileMenu = () => {
                mobileMenu.classList.add('open');
                mobileMenuOverlay.classList.remove('hidden');
            };

            const closeMobileMenu = () => {
                mobileMenu.classList.remove('open');
                mobileMenuOverlay.classList.add('hidden');
            };

            const openSettingsModal = () => {
                settingsModal.classList.remove('hidden');
                modalOverlay.classList.remove('hidden');
            };

            const closeSettingsModal = () => {
                settingsModal.classList.add('hidden');
                modalOverlay.classList.add('hidden');
            };

            function handleNavLinkClick(e) {
                const target = e.currentTarget;

                // If the link is meant to open in a new tab, allow default behavior
                if (target.target === '_blank') {
                    // No need to preventDefault() or handle iframe logic
                    if (mobileMenu.classList.contains('open')) closeMobileMenu(); // Close mobile menu if open
                    return;
                }

                if (target.id.includes('settings-btn')) {
                    e.preventDefault();
                    openSettingsModal();
                } else {
                    e.preventDefault();
                    const targetFrameId = target.dataset.target;
                    if (!targetFrameId) return;

                    const targetFrame = document.getElementById(targetFrameId);

                    if (targetFrame && !targetFrame.classList.contains('active')) {
                        // Deactivate the currently active frame
                        const activeFrame = document.querySelector('.content-iframe.active');
                        if (activeFrame) {
                            activeFrame.classList.remove('active');
                        }
                        // Activate the new frame
                        targetFrame.classList.add('active');

                        // Update active state for all links
                        document.querySelectorAll('#nav-links a, #mobile-nav-links a').forEach(l => l.classList.remove('active'));
                        document.querySelectorAll(`a[data-target="${targetFrameId}"]`).forEach(l => l.classList.add('active'));

                        // Update mobile header title
                        const activeLinkText = target.querySelector('span')?.textContent || 'Appdrawer';
                        mobileHeaderTitle.textContent = activeLinkText;
                    }
                }

                if (mobileMenu.classList.contains('open')) closeMobileMenu();
            }

            // Links f√ºr Mobile-Men√º klonen
            desktopNavLinks.forEach(link => {
                const li = document.createElement('li');
                const newLink = link.cloneNode(true);
                // Entfernen Sie die 'sidebar-text' Klasse, da sie nur f√ºr Desktop-Hover-Effekte relevant ist
                const sidebarTextSpan = newLink.querySelector('.sidebar-text');
                if (sidebarTextSpan) {
                    // For mobile, we want the text to be visible immediately.
                    sidebarTextSpan.style.opacity = 1;
                    sidebarTextSpan.style.maxWidth = '150px';
                    sidebarTextSpan.classList.remove('sidebar-text');
                }
                newLink.classList.add('w-full');
                li.appendChild(newLink);
                mobileNavLinksContainer.appendChild(li);
                newLink.addEventListener('click', handleNavLinkClick);
            });

            desktopNavLinks.forEach(link => link.addEventListener('click', handleNavLinkClick));

            hamburgerBtn.addEventListener('click', openMobileMenu);
            closeMobileMenuBtn.addEventListener('click', closeMobileMenu);
            mobileMenuOverlay.addEventListener('click', closeMobileMenu);

            closeModalBtn.addEventListener('click', closeSettingsModal);
            modalOverlay.addEventListener('click', (e) => {
                if (!settingsModal.classList.contains('hidden')) closeSettingsModal();
            });

            // --- Theme Wechsler ---
            const themeRadios = document.querySelectorAll('input[name="theme"]');
            function applyTheme(theme) {
                let effectiveTheme;
                if (theme === 'system') {
                    effectiveTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                } else {
                    effectiveTheme = theme;
                }
                document.documentElement.dataset.theme = effectiveTheme;
                contentFrames.forEach(frame => {
                    try {
                        if (frame.contentWindow) {
                            frame.contentWindow.postMessage(`set-theme-${effectiveTheme}`, '*');
                        }
                    } catch (e) { /* ignore cross-origin errors */ }
                });
            }
            function handleThemeChange(event) {
                const selectedTheme = event.target.value;
                localStorage.setItem('theme', selectedTheme);
                applyTheme(selectedTheme);
            }

            themeRadios.forEach(radio => radio.addEventListener('change', handleThemeChange));
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                const savedTheme = localStorage.getItem('theme') || 'system';
                if (savedTheme === 'system') applyTheme('system');
            });

            // --- Iframe Loading and Initial State ---
            let loadedFrames = 0;
            const totalFrames = contentFrames.length;

            if (totalFrames > 0) {
                contentFrames.forEach(frame => {
                    frame.addEventListener('load', () => {
                        loadedFrames++;
                        const savedTheme = localStorage.getItem('theme') || 'system';
                        let effectiveTheme = savedTheme === 'system' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : savedTheme;
                        try {
                            if (frame.contentWindow) {
                                frame.contentWindow.postMessage(`set-theme-${effectiveTheme}`, '*');
                            }
                        } catch (e) { /* ignore */ }

                        if (loadedFrames >= totalFrames) {
                            contentLoader.classList.add('hidden');
                        }
                    });
                });
            } else {
                contentLoader.classList.add('hidden');
            }

            // Initialen Status setzen
            const savedTheme = localStorage.getItem('theme') || 'system';
            const themeRadio = document.querySelector(`input[name="theme"][value="${savedTheme}"]`);
            if (themeRadio) themeRadio.checked = true;
            applyTheme(savedTheme);

            const initialActiveLink = document.querySelector('#nav-links a.active');
            if (initialActiveLink) {
                mobileHeaderTitle.textContent = initialActiveLink.querySelector('span').textContent;
            }
        });
    </script>
</body>

</html>
